---
phase: 08.1-tcp-interface-interop
plan: 01
subsystem: testing
tags: [tcp, hdlc, framing, interop, python, diagnostics]

# Dependency graph
requires:
  - phase: 08-propagated-delivery
    provides: TCP interface implementation for delivery testing
provides:
  - Debug logging for TCPClientInterface via -Dreticulum.tcp.debug=true
  - Minimal Python TCP interop test (bypasses bridge complexity)
  - Frame counters and hex previews for packet debugging
affects: [08.1-02, 08.1-03]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - System property for debug logging control
    - Stdout/stdin protocol for test process communication
    - HDLC frame-level testing isolation

key-files:
  created:
    - rns-test/src/test/kotlin/network/reticulum/integration/TcpPythonInteropTest.kt
    - rns-test/src/test/resources/python_tcp_test_server.py
  modified:
    - rns-interfaces/src/main/kotlin/network/reticulum/interfaces/tcp/TCPClientInterface.kt

key-decisions:
  - "Use system property reticulum.tcp.debug for debug logging (avoids runtime overhead when disabled)"
  - "Minimal Python server bypasses RNS stack to isolate TCP/HDLC layer"
  - "20-byte minimum packet size to pass HEADER_MINSIZE check in deframer"

patterns-established:
  - "Debug logging pattern: guarded by static DEBUG flag from system property"
  - "Python test server pattern: stdin/stdout protocol (SEND/QUIT/READY/RECEIVED/SENT)"

# Metrics
duration: 5min
completed: 2026-01-24
---

# Phase 8.1 Plan 01: TCP Diagnostics and Interop Testing Summary

**Debug logging for TCP frame boundaries with minimal Python interop test proving basic TCP/HDLC compatibility works**

## Performance

- **Duration:** 5 min
- **Started:** 2026-01-24T22:29:35Z
- **Completed:** 2026-01-24T22:34:39Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments
- Added comprehensive debug logging to TCPClientInterface at 5 key points (connect, write, receive, state change, error)
- Created minimal Python TCP server using RNS-compatible HDLC framing
- Implemented 4 isolated interop tests that all pass:
  1. Connection stability (holds 5 seconds)
  2. Kotlin-to-Python packet delivery
  3. Python-to-Kotlin packet delivery
  4. Bidirectional exchange (10 packets each way)
- Proved that basic TCP/HDLC interop between Kotlin and Python works at transport level

## Task Commits

Each task was committed atomically:

1. **Task 1: Add diagnostic logging to TCPClientInterface** - `47cc004` (feat)
2. **Task 2: Create minimal Python TCP interop test** - `e5123fd` (feat)

## Files Created/Modified
- `rns-interfaces/src/main/kotlin/network/reticulum/interfaces/tcp/TCPClientInterface.kt` - Debug logging at socket/frame boundaries
- `rns-test/src/test/kotlin/network/reticulum/integration/TcpPythonInteropTest.kt` - 4 isolated TCP interop tests
- `rns-test/src/test/resources/python_tcp_test_server.py` - Minimal Python TCP server with stdin/stdout control

## Decisions Made
- Used system property `reticulum.tcp.debug` for debug flag (no runtime overhead when disabled)
- Created minimal Python server instead of using full RNS TCPServerInterface to isolate TCP layer
- Used 20-byte packets to exceed HEADER_MINSIZE (19 bytes) in deframer
- Implemented stdout/stdin protocol for test control (simpler than socket-based control channel)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
- Existing Kotlin-to-Kotlin TCP tests (TcpIntegrationTest) have failures in packet transmission tests
- This is a pre-existing issue unrelated to this plan's changes
- The new Python interop tests pass, indicating basic TCP/HDLC works correctly

## Key Finding

**The basic TCP/HDLC layer works correctly between Kotlin and Python.** All 4 tests pass with bidirectional packet exchange. This suggests the interop issue reported in Phase 8.1 research may be at a higher layer (RNS Transport, LXMF, or test infrastructure) rather than the TCP framing layer itself.

The debug logging now available will help diagnose where in the stack the actual failure occurs when running full E2E tests.

## Next Phase Readiness
- Diagnostic logging is ready for use in E2E debugging
- Minimal interop test provides baseline for TCP layer verification
- Next plan (08.1-02) should test with actual RNS TCPServerInterface instead of minimal server
- Debug output can be examined to identify exact failure mode in full stack tests

---
*Phase: 08.1-tcp-interface-interop*
*Completed: 2026-01-24*
